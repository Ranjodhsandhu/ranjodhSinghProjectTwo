const{cognitoDomain:cognitoDomain,clientId:clientId,redirectUri:redirectUri,logoutUri:logoutUri,recipeEndpoint:recipeEndpoint}=window.APP_CONFIG;async function redirectToCognitoSignin(){const e=generateRandomString(64);sessionStorage.setItem("pkce_verifier",e);const n=await generateCodeChallenge(e);window.location.href=`${cognitoDomain}/login?client_id=${clientId}&response_type=code&scope=email+openid+phone+profile&redirect_uri=${redirectUri}&code_challenge=${n}&code_challenge_method=S256`}function signOutRedirect(){window.location.href=`${cognitoDomain}/logout/?client_id=${clientId}&logout_uri=${logoutUri}`}function callAwsData(){const e=getAccessToken(),n=document.getElementById("spinner");n.classList.remove("hidden"),fetch(recipeEndpoint,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(e=>(401===e.status&&redirectToCognitoSignin(),e.json())).then(e=>{const t=document.getElementById("recipeTableWrapper"),o=document.getElementById("recipeTable");o.innerHTML="";const i=e;i.records?.length>0?(i.records.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`<td>${e.Name}</td>`,o.appendChild(n)}),t.classList.remove("hidden")):t.classList.add("hidden"),n.classList.add("hidden")}).catch(e=>console.error("Error fetching data from AWS:",e))}function generateRandomString(e){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let o=0;o<e;o++)t+=n.charAt(Math.floor(62*Math.random()));return t}async function convertSH256(e){const n=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",n)}function base64UrlEncode(e){return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function generateCodeChallenge(e){return base64UrlEncode(await convertSH256(e))}function storeTokens(e){sessionStorage.setItem("access_token",e.access_token),sessionStorage.setItem("id_token",e.id_token),sessionStorage.setItem("expires_in",e.expires_in)}function getAccessToken(){return sessionStorage.getItem("access_token")}function getIdToken(){return sessionStorage.getItem("id_token")}function getExpiresIn(){return sessionStorage.getItem("expires_in")}function parseJWTIdToken(e){if(!e)return null;const n=e.split(".")[1].replace(/-/g,"+").replace(/_/,"/"),t=decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(t)}function isLoggedIn(){if(!getIdToken())return!1;try{const e=parseJWTIdToken(sessionStorage.getItem("id_token"));return Date.now()<1e3*e.exp}catch{return!1}}function updateAuthUI(){const e=document.getElementById("authorize"),n=document.getElementById("welcome");if(isLoggedIn()){const t=parseJWTIdToken(sessionStorage.getItem("id_token")).name;e.innerText="Sign Out",e.onclick=signOutRedirect,n.innerText=`Hi, ${t}`}else e.innerText="Sign In",e.onclick=redirectToCognitoSignin,n.innerText=""}function getCodeFromUrl(){return new URLSearchParams(window.location.search).get("code")}async function exchangeCodeForToken(e){const n=sessionStorage.getItem("pkce_verifier"),t=cognitoDomain+"/oauth2/token",o=new URLSearchParams;o.append("grant_type","authorization_code"),o.append("client_id",clientId),o.append("code",e),o.append("redirect_uri",redirectUri),o.append("code_verifier",n);const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});return await i.json()}async function handleAuthRedirect(){const e=getCodeFromUrl();let n="";e&&(n=await exchangeCodeForToken(e)),n.access_token&&(storeTokens(n),window.history.replaceState({},document.title,window.location.pathname)),updateAuthUI()}document.addEventListener("DOMContentLoaded",()=>{handleAuthRedirect()});const openBtn=document.getElementById("openPopupBtn"),popup=document.getElementById("popup"),cancelRecipe=document.getElementById("cancelRecipe"),addRecipe=document.getElementById("addRecipe"),input=document.getElementById("popupInput");openBtn.addEventListener("click",()=>{popup.classList.remove("hidden"),input.value="",input.focus()}),cancelRecipe.addEventListener("click",()=>{popup.classList.add("hidden")}),addRecipe.addEventListener("click",()=>{const e=document.getElementById("recipespinner");e.classList.remove("hidden");const n=getAccessToken(),t=input.value.trim();0!==t.length?fetch(recipeEndpoint,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({name:t})}).then(e=>(401===e.status&&redirectToCognitoSignin(),e.json())).then(n=>{e.classList.add("hidden"),popup.classList.add("hidden")}).catch(e=>console.error("Error Saving Recipe:",e)):alert("Please enter a recipe name")}),popup.addEventListener("click",e=>{e.target===popup&&popup.classList.add("hidden")});
